# Spark I/O Optimization Configuration
# This file contains various configurations to test different I/O optimization strategies

# ============================================================================
# SHUFFLE I/O OPTIMIZATIONS
# ============================================================================

# External shuffle service for better shuffle performance
spark.shuffle.service.enabled true
spark.shuffle.service.port 7337

# Shuffle compression settings

spark.io.compression.codec lz4

# Shuffle memory and spill settings
spark.shuffle.memoryFraction 0.3

spark.shuffle.spill.batchSize 10000

# ============================================================================
# MEMORY AND STORAGE OPTIMIZATIONS
# ============================================================================

# Tungsten project optimizations
spark.sql.tungsten.enabled true
spark.sql.adaptive.enabled true
spark.sql.adaptive.coalescePartitions.enabled true

# Memory management
spark.memory.fraction 0.8
spark.memory.storageFraction 0.3
spark.memory.offHeap.enabled false
spark.memory.offHeap.size 1g

# ============================================================================
# NETWORK I/O OPTIMIZATIONS
# ============================================================================

# Network timeout settings
spark.network.timeout 800s
spark.executor.heartbeatInterval 60s

# RPC settings
spark.rpc.askTimeout 800s
spark.rpc.lookupTimeout 800s

# ============================================================================
# S3 OPTIMIZATIONS (when using S3)
# ============================================================================

# S3 committer settings
spark.sql.adaptive.enabled true
spark.sql.adaptive.coalescePartitions.enabled true

# S3 multipart upload settings
spark.hadoop.fs.s3a.multipart.uploads.enabled true
spark.hadoop.fs.s3a.multipart.uploads.block.size 134217728

# S3 buffer settings
spark.hadoop.fs.s3a.buffer.dir /tmp/s3a
spark.hadoop.fs.s3a.fast.upload true
spark.hadoop.fs.s3a.fast.upload.buffer disk

# ============================================================================
# EXECUTOR SETTINGS
# ============================================================================

# Executor memory and cores
spark.executor.memory 2g
spark.executor.cores 2
spark.executor.instances 2

# Dynamic allocation
spark.dynamicAllocation.enabled true
spark.dynamicAllocation.minExecutors 1
spark.dynamicAllocation.maxExecutors 10
spark.dynamicAllocation.initialExecutors 2

# ============================================================================
# DEBUGGING AND MONITORING
# ============================================================================

# Event logging for performance analysis
spark.eventLog.enabled true
spark.eventLog.dir /opt/spark/logs
spark.history.fs.logDirectory /opt/spark/logs

# Metrics
spark.metrics.conf /opt/spark/conf/metrics.properties
